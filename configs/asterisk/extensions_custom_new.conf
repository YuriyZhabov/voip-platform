[from-novofon]
; Обработка входящих звонков от Novofon
exten => 79952227978,1,NoOp(=== Incoming call from Novofon ===)
same => n,Set(CALLERID(name)=Novofon-${CALLERID(num)})
same => n,Set(__CHANNEL_NAME=${CHANNEL})
same => n,Set(__CALL_START_TIME=${EPOCH})
same => n,Verbose(1,Call from ${CALLERID(all)} to ${EXTEN})
same => n,Answer()
same => n,Wait(1)
same => n,Set(CHANNEL(language)=ru)
same => n,Stasis(livekit-agent,${EXTEN},${CALLERID(num)})
same => n,Hangup()

; Обработка входящих звонков с префиксом +7
exten => +79952227978,1,Goto(from-novofon,79952227978,1)

; Обработка любых входящих звонков (fallback)
exten => _X.,1,NoOp(=== Fallback incoming call ===)
same => n,Set(CALLERID(name)=Unknown-${CALLERID(num)})
same => n,Answer()
same => n,Wait(1)
same => n,Set(CHANNEL(language)=ru)
same => n,Stasis(livekit-agent,${EXTEN},${CALLERID(num)})
same => n,Hangup()

; Обработка завершения звонков
exten => h,1,NoOp(=== Call ended ===)
same => n,Set(CALL_DURATION=$[${EPOCH} - ${CALL_START_TIME}])
same => n,Verbose(1,Call duration: ${CALL_DURATION} seconds)
same => n,Verbose(1,Hangup cause: ${HANGUPCAUSE})

[from-internal-custom]
; Тестовый звонок для проверки Novofon
exten => 8888,1,NoOp(=== Test call to Novofon ===)
same => n,Set(CALLERID(num)=79952227978)
same => n,Dial(PJSIP/8888@0053248,30)
same => n,Hangup()

; Тестовый звонок для проверки LiveKit
exten => 9999,1,NoOp(=== Test LiveKit integration ===)
same => n,Answer()
same => n,Wait(1)
same => n,Stasis(livekit-agent,test,test)
same => n,Hangup()

; Проверка статуса системы
exten => *123,1,NoOp(=== System status check ===)
same => n,Answer()
same => n,Playback(system-status)
same => n,SayNumber(${EPOCH})
same => n,Wait(2)
same => n,Hangup()

[to-novofon]
; Исходящие звонки через Novofon
exten => _X.,1,NoOp(=== Outgoing call via Novofon to ${EXTEN} ===)
same => n,Set(CALLERID(num)=79952227978)
same => n,Set(CALLERID(name)=StellarAgents)
same => n,Dial(PJSIP/${EXTEN}@0053248,60)
same => n,Hangup()

[to-livekit]
; Звонки к LiveKit (если потребуется)
exten => _X.,1,NoOp(=== Call to LiveKit: ${EXTEN} ===)
same => n,Dial(PJSIP/${EXTEN}@livekit,30)
same => n,Hangup()

[internal]
; Внутренние звонки
exten => _1XX,1,NoOp(=== Internal call to ${EXTEN} ===)
same => n,Dial(PJSIP/${EXTEN})
same => n,Hangup()