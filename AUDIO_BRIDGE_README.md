# üé§ VoIP AI Agent —Å –ê—É–¥–∏–æ –ú–æ—Å—Ç–æ–º

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –ò–ò –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Asterisk –∏ LiveKit —á–µ—Ä–µ–∑ –∞—É–¥–∏–æ –º–æ—Å—Ç.

## üéØ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### ‚úÖ –ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **AudioBridge** (`audio_bridge.py`) - –º–æ—Å—Ç –º–µ–∂–¥—É Asterisk –∏ LiveKit
- **MainAgent** (`main_agent.py`) - –≥–ª–∞–≤–Ω—ã–π –∞–≥–µ–Ω—Ç —Å–∏—Å—Ç–µ–º—ã
- **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –¥–∏–∞–ª–ø–ª–∞–Ω** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—É–¥–∏–æ –º–æ—Å—Ç–∞
- **Health check** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

### üîß –£–ª—É—á—à–µ–Ω–∏—è:
- –†–µ–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –∞—É–¥–∏–æ –º–µ–∂–¥—É Asterisk –∏ LiveKit
- –†—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã–π –ò–ò –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ (–ø–æ–≥–æ–¥–∞, –≤—Ä–µ–º—è)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–∞–º–∏
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –¢–µ—Å—Ç–æ–≤—ã–µ –Ω–æ–º–µ—Ä–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
```bash
# –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
./scripts/update-to-audio-bridge.sh
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã
```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
./scripts/test-audio-bridge.sh
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –õ–æ–≥–∏ –∞–≥–µ–Ω—Ç–∞
docker logs livekit-agent -f

# Health check
curl http://localhost:8081/health

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
curl http://localhost:8081/stats
```

## üìû –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã:
1. **–ó–≤–æ–Ω–æ–∫ –ø–æ—Å—Ç—É–ø–∞–µ—Ç** –Ω–∞ Novofon ‚Üí Asterisk
2. **–î–∏–∞–ª–ø–ª–∞–Ω** –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–≤–æ–Ω–æ–∫ –≤ Stasis –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. **AudioBridge** –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ –∏ —Å–æ–∑–¥–∞–µ—Ç LiveKit –∫–æ–º–Ω–∞—Ç—É
4. **–ê—É–¥–∏–æ –º–æ—Å—Ç** —Å–æ–µ–¥–∏–Ω—è–µ—Ç Asterisk –∫–∞–Ω–∞–ª —Å LiveKit
5. **–ò–ò –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç** –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

#### üåâ AudioBridge
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç ARI —Å–æ–±—ã—Ç–∏—è –æ—Ç Asterisk
- –°–æ–∑–¥–∞–µ—Ç LiveKit –∫–æ–º–Ω–∞—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–≤–æ–Ω–∫–∞
- –£–ø—Ä–∞–≤–ª—è–µ—Ç –∞—É–¥–∏–æ –º–æ—Å—Ç–∞–º–∏ –º–µ–∂–¥—É –∫–∞–Ω–∞–ª–∞–º–∏
- –ó–∞–ø—É—Å–∫–∞–µ—Ç –ò–ò –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤

#### ü§ñ MainAgent
- –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç HTTP API –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –£–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### üìã –î–∏–∞–ª–ø–ª–∞–Ω
- `from-novofon` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö –∑–≤–æ–Ω–∫–æ–≤
- `livekit-bridge` - –º–æ—Å—Ç–æ–≤—ã–µ –∫–∞–Ω–∞–ª—ã –¥–ª—è LiveKit
- –¢–µ—Å—Ç–æ–≤—ã–µ –Ω–æ–º–µ—Ä–∞ (9999, 8888, 7777, 6666)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–µ –Ω–æ–º–µ—Ä–∞:
- **9999** - —Ç–µ—Å—Ç –ò–ò –∞–≥–µ–Ω—Ç–∞
- **8888** - —Ç–µ—Å—Ç —ç—Ö–æ
- **7777** - —Ç–µ—Å—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
- **6666** - —Ç–µ—Å—Ç –∑–∞–ø–∏—Å–∏

### –û—Å–Ω–æ–≤–Ω–æ–π –Ω–æ–º–µ—Ä:
- **+79952227978** - —Ä–∞–±–æ—á–∏–π –Ω–æ–º–µ—Ä —Å –ò–ò –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`:
```bash
# LiveKit
LIVEKIT_URL=wss://your-instance.livekit.cloud
LIVEKIT_API_KEY=your_api_key
LIVEKIT_API_SECRET=your_api_secret

# AI —Å–µ—Ä–≤–∏—Å—ã
OPENAI_API_KEY=sk-proj-your_key
DEEPGRAM_API_KEY=your_key
CARTESIA_API_KEY=sk_car_your_key

# Novofon
NOVOFON_USERNAME=your_username
NOVOFON_PASSWORD=your_password
NOVOFON_NUMBER=+79952227978
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ò–ò:
```bash
# OpenAI
OPENAI_MODEL=gpt-4o-mini
OPENAI_TEMPERATURE=0.7

# Deepgram (STT)
DEEPGRAM_MODEL=nova-2
DEEPGRAM_LANGUAGE=ru

# Cartesia (TTS)
CARTESIA_MODEL=sonic-multilingual
CARTESIA_VOICE=87748186-23bb-4158-a1eb-332911b0b708
CARTESIA_LANGUAGE=ru
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### HTTP API:
- `GET /health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
- `GET /status` - –¥–µ—Ç–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
- `GET /stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–≤–æ–Ω–∫–æ–≤

### –õ–æ–≥–∏:
```bash
# –í—Å–µ –ª–æ–≥–∏ –∞–≥–µ–Ω—Ç–∞
docker logs livekit-agent -f

# –õ–æ–≥–∏ Asterisk
docker logs freepbx-server -f

# –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏
docker-compose logs -f
```

### Asterisk CLI:
```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–Ω—Å–æ–ª–∏
docker exec -it freepbx-server asterisk -rvvv

# –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
ari show apps              # ARI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
dialplan show from-novofon  # –î–∏–∞–ª–ø–ª–∞–Ω
core show channels         # –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
```

## üõ†Ô∏è –û—Ç–ª–∞–¥–∫–∞

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

#### 1. ARI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ ARI –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
docker exec freepbx-server cat /etc/asterisk/ari.conf

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ ARI –º–æ–¥—É–ª—è
docker exec freepbx-server asterisk -rx "module reload res_ari.so"
```

#### 2. –î–∏–∞–ª–ø–ª–∞–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ª–ø–ª–∞–Ω–∞
docker exec freepbx-server asterisk -rx "dialplan show from-novofon"

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∏–∞–ª–ø–ª–∞–Ω–∞
docker exec freepbx-server asterisk -rx "dialplan reload"
```

#### 3. LiveKit –∞–≥–µ–Ω—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ health check
curl -v http://localhost:8081/health

# –õ–æ–≥–∏ –∞–≥–µ–Ω—Ç–∞
docker logs livekit-agent --tail=50
```

#### 4. –ù–µ—Ç –∑–≤—É–∫–∞ –≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–µ
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ—Å—Ç–æ–≤
docker exec freepbx-server asterisk -rx "bridge show all"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–Ω–∞–ª–æ–≤
docker exec freepbx-server asterisk -rx "core show channels verbose"
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞:
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã
docker-compose down

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤
docker-compose build --no-cache

# –ó–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
./scripts/update-to-audio-bridge.sh
```

### –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏:
```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
cp -r ./data/asterisk/config.backup.* ./data/asterisk/config/

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
docker-compose restart
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã:
- **CPU**: 2+ —è–¥—Ä–∞
- **RAM**: 4+ GB
- **–î–∏—Å–∫**: 20+ GB SSD
- **–°–µ—Ç—å**: —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –ú–∞–∫—Å–∏–º—É–º 10 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–≤–æ–Ω–∫–∞: 30 –º–∏–Ω—É—Ç
- –¢–∞–π–º–∞—É—Ç —Ç–∏—à–∏–Ω—ã: 5 –º–∏–Ω—É—Ç

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```bash
# –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
./scripts/test-audio-bridge.sh

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –∞–≥–µ–Ω—Ç–∞
docker-compose restart livekit-agent

# –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤
docker system prune -f
```

### –ö–æ–Ω—Ç–∞–∫—Ç—ã:
- –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã: `/data/logs/`
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: `/configs/`
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `README.md`

---

üéâ **–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!** –ó–≤–æ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –Ω–æ–º–µ—Ä –∏ –æ–±—â–∞–π—Ç–µ—Å—å —Å –ò–ò –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º!